<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analiza Polygons</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"
  />
  <link rel="stylesheet" href="styles.css" />
  <link
    rel="icon"
    type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%232563eb'/%3E%3Cpath d='M26 50l18 18 30-36' stroke='%23fff' stroke-width='10' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"
  />
</head>
<body>
  <header class="hero">
    <div>
      <p class="eyebrow">Analiza Polygons</p>
      <h1>Mapa real de OpenStreetMap listo para capturar coordenadas</h1>
      <p class="lead">
        Dibuja polígonos directamente sobre un mapa embebido y copia las coordenadas con el formato que prefieras.
      </p>
      <div class="cta-row">
        <button id="copy-btn" class="primary">Exportar polígonos</button>
        <button id="reset-btn" class="ghost">Limpiar mapa</button>
      </div>
    </div>
  </header>

  <main class="content">
    <section class="panel">
      <div class="panel-header">
        <div>
          <p class="eyebrow">Mapa base</p>
          <h2>Dibuja sobre OpenStreetMap</h2>
        </div>
        <div class="import-controls">
          <input type="file" id="geojson-input" accept=".geojson,.json" hidden />
          <button id="import-btn" class="primary" type="button">Importar GeoJSON</button>
          <button id="import-example-btn" class="ghost" type="button">Cargar ejemplo</button>
        </div>
        <span id="map-status" class="status"></span>
      </div>
      <div id="map" aria-label="Mapa de dibujo"></div>
      <div class="visibility-toggles" aria-label="Alternar visibilidad de polígonos importados">
        <label class="toggle">
          <input id="toggle-original" type="checkbox" checked />
          <span>Mostrar polígonos originales (GeoJSON)</span>
        </label>
        <label class="toggle">
          <input id="toggle-simplified" type="checkbox" checked />
          <span>Mostrar polígonos simplificados</span>
        </label>
        <label class="toggle">
          <input id="toggle-names" type="checkbox" checked />
          <span>Mostrar nombres en el mapa</span>
        </label>
      </div>
      <div class="helper">
        <p><strong>Cómo usarlo</strong></p>
        <ol>
          <li>Selecciona la herramienta de polígono y haz clic en el mapa para definir cada vértice.</li>
          <li>El panel inferior lista cada polígono numerado con sus coordenadas.</li>
          <li>Copia el resultado y pégalo en tu flujo de trabajo.</li>
        </ol>
      </div>
    </section>

    <section class="panel log-visual">
      <header class="panel-header">
        <div>
          <p class="eyebrow">Registro</p>
          <h2>Pasos de importación</h2>
        </div>
      </header>
      <div id="visual-log" class="log-entries" aria-live="polite">
        <div class="log-entry info">Listo para registrar los pasos de importación.</div>
      </div>
    </section>

    <section class="panel">
      <header class="panel-header">
        <div>
          <p class="eyebrow">Exportación</p>
          <h2>Coordenadas generadas</h2>
        </div>
        <div class="export-controls">
          <button id="copy-qlik-if-btn" class="ghost">Copiar IF Qlik</button>
          <button id="copy-qlik-btn" class="ghost emphasis">Copiar modo Qlik</button>
          <span id="copy-status" class="status"></span>
        </div>
      </header>
      <pre id="output" aria-live="polite" class="output">Crea al menos un polígono para ver sus coordenadas aquí.</pre>
      <div class="if-preview">
        <p><strong>Vista previa IF</strong></p>
        <pre id="if-preview" aria-live="polite" class="output soft">Genera una expresión IF desde el modal para verla aquí.</pre>
      </div>
    </section>
  </main>

  <div id="if-modal" class="if-modal" role="dialog" aria-modal="true" aria-labelledby="if-modal-title" aria-hidden="true">
    <div class="if-modal__content">
      <header class="if-modal__header">
        <div>
          <p class="eyebrow">Exportar IF</p>
          <h3 id="if-modal-title">Configura la expresión IF para Qlik</h3>
        </div>
        <button id="if-modal-close" class="icon-btn" aria-label="Cerrar modal">×</button>
      </header>
      <form id="if-form" class="if-form">
        <label class="field field--inline">
          <span>¿Usar valores de nombre de los polígonos?</span>
          <input id="use-polygon-names" name="usePolygonNames" type="checkbox" />
        </label>
        <label class="field">
          <span>Nombre del tesauro</span>
          <input id="thesaurus-name" name="thesaurus" type="text" placeholder="Ej. campo_municipio" required />
        </label>
        <div id="polygon-values" class="polygon-values" aria-live="polite"></div>
        <p id="polygon-values-helper" class="helper helper--compact">
          Activa los valores manuales si prefieres elegir un tesauro diferente para cada polígono.
        </p>
        <div class="if-form__actions">
          <button type="button" id="if-cancel" class="ghost">Cancelar</button>
          <button type="submit" class="primary">Generar y copiar IF</button>
        </div>
      </form>
    </div>
  </div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <link
    rel="icon"
    type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%232563eb'/%3E%3Cpath d='M26 50l18 18 30-36' stroke='%23fff' stroke-width='10' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"
  />
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="main.js"></script>
</body>
</html>
